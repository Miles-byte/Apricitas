#TARIFF OVER TIME DATA
CHINA_IMPORTS <- getCensus(
  name = "timeseries/intltrade/imports/hs",
  vars = c("CON_VAL_YR","CTY_CODE", "CTY_NAME"), 
  time = "2024-12",
  CTY_NAME = "CHINA",
  CTY_NAME = "HONG KONG",
)

CHINA_TOTAL <- CHINA_IMPORTS %>%
  mutate(CON_VAL_YR = as.numeric(CON_VAL_YR)) %>%
  mutate(CTY_NAME = case_when(CTY_NAME == "CHINA" ~ "China",
                              CTY_NAME == "HONG KONG" ~ "China",
                              TRUE ~ CTY_NAME)) %>%
  mutate(CTY_CODE = case_when(CTY_CODE == "5700" ~ "5700",
                              CTY_CODE == "5820" ~ "5700",
                              TRUE ~ CTY_CODE)) %>%
  group_by(CTY_NAME) %>%
  summarize(time,CTY_CODE,CON_VAL_YR = sum(CON_VAL_YR, na.rm = TRUE)) %>%
  ungroup() %>%
  unique()

MEXICO_IMPORTS <- getCensus(
  name = "timeseries/intltrade/imports/hs",
  vars = c("CON_VAL_YR","CTY_CODE", "CTY_NAME"), 
  time = "2024-12",
  CTY_NAME = "MEXICO",
)

MEXICO_TOTAL <- MEXICO_IMPORTS %>%
  mutate(CON_VAL_YR = as.numeric(CON_VAL_YR))

MEXICO_IMPORTS_USMCA <- getCensus(
  name = "timeseries/intltrade/imports/hs",
  vars = c("CON_VAL_YR","CTY_CODE", "CTY_NAME","RP"), 
  time = "2024-12",
  CTY_NAME = "MEXICO",
  RP = "18",
)

MEXICO_TOTAL_USMCA <- MEXICO_IMPORTS_USMCA %>%
  mutate(CON_VAL_YR = as.numeric(CON_VAL_YR))

CANADA_IMPORTS <- getCensus(
  name = "timeseries/intltrade/imports/hs",
  vars = c("CON_VAL_YR","CTY_CODE", "CTY_NAME","I_COMMODITY"), 
  I_COMMODITY = "27",
  I_COMMODITY = "-",
  time = "2024-12",
  CTY_NAME = "CANADA",
)

CANADA_TOTAL <- CANADA_IMPORTS %>%
  filter(I_COMMODITY == "-") %>%
  select(-I_COMMODITY) %>%
  mutate(CON_VAL_YR = as.numeric(CON_VAL_YR)) %>%
  group_by(CTY_NAME) %>%
  summarize(time,CTY_CODE,CON_VAL_YR = sum(CON_VAL_YR, na.rm = TRUE)) %>%
  ungroup() %>%
  unique()

CANADA_SPLIT <- CANADA_IMPORTS %>%
  mutate(CON_VAL_YR = as.numeric(CON_VAL_YR))

CANADA_IMPORTS_USMCA <- getCensus(
  name = "timeseries/intltrade/imports/hs",
  vars = c("CON_VAL_YR","CTY_CODE", "CTY_NAME","I_COMMODITY","RP"), 
  I_COMMODITY = "27",
  I_COMMODITY = "-",
  time = "2024-12",
  CTY_NAME = "CANADA",
  RP = "18",
)

CANADA_TOTAL_USMCA <- CANADA_IMPORTS_USMCA %>%
  filter(I_COMMODITY == "-") %>%
  select(-I_COMMODITY) %>%
  mutate(CON_VAL_YR = as.numeric(CON_VAL_YR)) %>%
  group_by(CTY_NAME) %>%
  summarize(time,CTY_CODE,CON_VAL_YR = sum(CON_VAL_YR, na.rm = TRUE)) %>%
  ungroup() %>%
  unique()

CANADA_SPLIT_USMCA <- CANADA_IMPORTS_USMCA %>%
  mutate(CON_VAL_YR = as.numeric(CON_VAL_YR))



EU_IMPORTS <- getCensus(
  name = "timeseries/intltrade/imports/hs",
  vars = c("CON_VAL_YR","CTY_CODE", "CTY_NAME"), 
  time = "2024-12",
  CTY_NAME = "EUROPEAN UNION",
)

EU_TOTAL <- EU_IMPORTS %>%
  mutate(CON_VAL_YR = as.numeric(CON_VAL_YR))

STEEL_IMPORTS <- getCensus(
  name = "timeseries/intltrade/imports/hs",
  vars = c("CON_VAL_YR","I_COMMODITY","CTY_CODE", "CTY_NAME"), 
  time = "2024-12",
  I_COMMODITY = "7208",
  I_COMMODITY = "7209",
  I_COMMODITY = "7210",
  I_COMMODITY = "7211",
  I_COMMODITY = "7212",
  I_COMMODITY = "7225",
  I_COMMODITY = "7226",
  I_COMMODITY = "7213",
  I_COMMODITY = "7214",
  I_COMMODITY = "7215",
  I_COMMODITY = "7227",
  I_COMMODITY = "7228",
  I_COMMODITY = "7208",
  I_COMMODITY = "7216",
  I_COMMODITY = "7217",
  I_COMMODITY = "7229",
  I_COMMODITY = "730110",
  I_COMMODITY = "730210",
  I_COMMODITY = "730240",
  I_COMMODITY = "730290",
  I_COMMODITY = "7304",
  I_COMMODITY = "7306",
  I_COMMODITY = "7305",
  I_COMMODITY = "7206",
  I_COMMODITY = "7207",
  I_COMMODITY = "7224",
  I_COMMODITY = "7218",
  I_COMMODITY = "7219",
  I_COMMODITY = "7220",
  I_COMMODITY = "7221",
  I_COMMODITY = "7222",
  I_COMMODITY = "7223",
  CTY_NAME = "TOTAL FOR ALL COUNTRIES",
  CTY_NAME = "CHINA",
  CTY_NAME = "HONG KONG",
  CTY_NAME = "MEXICO",
  CTY_NAME = "CANADA",
  CTY_NAME = "EUROPEAN UNION",
)

STEEL_TOTAL <- STEEL_IMPORTS %>%
  mutate(CON_VAL_YR = as.numeric(CON_VAL_YR)) %>%
  group_by(CTY_NAME) %>%
  summarize(time,CTY_CODE,CON_VAL_YR = sum(CON_VAL_YR, na.rm = TRUE)) %>%
  ungroup() %>%
  unique()
  

ALUMINUM_IMPORTS <- getCensus(
  name = "timeseries/intltrade/imports/hs",
  vars = c("CON_VAL_YR","I_COMMODITY","CTY_CODE", "CTY_NAME"), 
  time = "2024-12",
  I_COMMODITY = "7601",
  I_COMMODITY = "7604",
  I_COMMODITY = "7605",
  I_COMMODITY = "7606",
  I_COMMODITY = "7607",
  I_COMMODITY = "7608",
  I_COMMODITY = "7609",
  I_COMMODITY = "7616995120",
  I_COMMODITY = "7616995130",
  I_COMMODITY = "7616995140",
  I_COMMODITY = "7616995150",
  I_COMMODITY = "7616995160",
  I_COMMODITY = "7616995170",
  I_COMMODITY = "7616995175",
  I_COMMODITY = "7616995190",
  CTY_NAME = "TOTAL FOR ALL COUNTRIES",
  CTY_NAME = "CHINA",
  CTY_NAME = "HONG KONG",
  CTY_NAME = "MEXICO",
  CTY_NAME = "CANADA",
  CTY_NAME = "EUROPEAN UNION",
)

ALUMINUM_TOTAL <- ALUMINUM_IMPORTS %>%
  mutate(CON_VAL_YR = as.numeric(CON_VAL_YR)) %>%
  group_by(CTY_NAME) %>%
  summarize(time,CTY_CODE,CON_VAL_YR = sum(CON_VAL_YR, na.rm = TRUE)) %>%
  ungroup() %>%
  unique()

COPPER_IMPORTS <- getCensus(
  name = "timeseries/intltrade/imports/hs",
  vars = c("CON_VAL_YR","I_COMMODITY","CTY_CODE", "CTY_NAME"), 
  time = "2024-12",
  I_COMMODITY = "74",
  CTY_NAME = "TOTAL FOR ALL COUNTRIES",
  CTY_NAME = "CHINA",
  CTY_NAME = "HONG KONG",
  CTY_NAME = "MEXICO",
  CTY_NAME = "CANADA",
  CTY_NAME = "EUROPEAN UNION",
)

COPPER_TOTAL <- COPPER_IMPORTS %>%
  mutate(CON_VAL_YR = as.numeric(CON_VAL_YR)) %>%
  group_by(CTY_NAME) %>%
  summarize(time,CTY_CODE,CON_VAL_YR = sum(CON_VAL_YR, na.rm = TRUE)) %>%
  ungroup() %>%
  unique()


CAR_IMPORTS <- getCensus(
  name = "timeseries/intltrade/imports/hs",
  vars = c("CON_VAL_YR","I_COMMODITY","CTY_CODE", "CTY_NAME"), 
  time = "2024-12",
  I_COMMODITY = "8703", #Cars/Light Trucks
  I_COMMODITY = "8708", #Vehicle Parts
  I_COMMODITY = "8704", #Freight Trucks
  CTY_NAME = "TOTAL FOR ALL COUNTRIES",
  CTY_NAME = "CHINA",
  CTY_NAME = "HONG KONG",
  CTY_NAME = "MEXICO",
  CTY_NAME = "CANADA",
  CTY_NAME = "EUROPEAN UNION",
)

CAR_TOTAL <- CAR_IMPORTS %>%
  mutate(CON_VAL_YR = as.numeric(CON_VAL_YR)) %>%
  group_by(CTY_NAME) %>%
  summarize(time,CTY_CODE,CON_VAL_YR = sum(CON_VAL_YR, na.rm = TRUE)) %>%
  ungroup() %>%
  unique()

PHARMA_IMPORTS <- getCensus(
  name = "timeseries/intltrade/imports/hs",
  vars = c("CON_VAL_YR","I_COMMODITY","CTY_CODE", "CTY_NAME"), 
  time = "2024-12",
  I_COMMODITY = "30",
  CTY_NAME = "TOTAL FOR ALL COUNTRIES",
  CTY_NAME = "CHINA",
  CTY_NAME = "HONG KONG",
  CTY_NAME = "MEXICO",
  CTY_NAME = "CANADA",
  CTY_NAME = "EUROPEAN UNION",
)

PHARMA_TOTAL <- PHARMA_IMPORTS %>%
  mutate(CON_VAL_YR = as.numeric(CON_VAL_YR)) %>%
  group_by(CTY_NAME) %>%
  summarize(time,CTY_CODE,CON_VAL_YR = sum(CON_VAL_YR, na.rm = TRUE)) %>%
  ungroup() %>%
  unique()

SEMICONDUCTOR_IMPORTS <- getCensus(
  name = "timeseries/intltrade/imports/hs",
  vars = c("CON_VAL_YR","I_COMMODITY","CTY_CODE", "CTY_NAME"), 
  time = "2024-12",
  I_COMMODITY = "8542",
  CTY_NAME = "TOTAL FOR ALL COUNTRIES",
  CTY_NAME = "CHINA",
  CTY_NAME = "HONG KONG",
  CTY_NAME = "MEXICO",
  CTY_NAME = "CANADA",
  CTY_NAME = "EUROPEAN UNION",
)

SEMI_TOTAL <- SEMICONDUCTOR_IMPORTS %>%
  mutate(CON_VAL_YR = as.numeric(CON_VAL_YR)) %>%
  group_by(CTY_NAME) %>%
  summarize(time,CTY_CODE,CON_VAL_YR = sum(CON_VAL_YR, na.rm = TRUE)) %>%
  ungroup() %>%
  unique()

CAR_IMPORTS <- getCensus(
  name = "timeseries/intltrade/imports/hs",
  vars = c("CON_VAL_YR","I_COMMODITY","CTY_CODE", "CTY_NAME"), 
  time = "2024-12",
  I_COMMODITY = "8703220110", 
  I_COMMODITY = "8703220190", 
  I_COMMODITY = "8703230110",
  I_COMMODITY = "8703230120",
  I_COMMODITY = "8703230130",
  I_COMMODITY = "8703230140",
  I_COMMODITY = "8703230160",
  I_COMMODITY = "8703230170",
  I_COMMODITY = "8703230190",
  I_COMMODITY = "8703240110",
  I_COMMODITY = "8703240130",
  I_COMMODITY = "8703240140",
  I_COMMODITY = "8703240150",
  I_COMMODITY = "8703240160",
  I_COMMODITY = "8703240190",
  I_COMMODITY = "8703310100",
  I_COMMODITY = "8703320110",
  I_COMMODITY = "8703320150", 
  I_COMMODITY = "8703330110", 
  I_COMMODITY = "8703330130", 
  I_COMMODITY = "8703330145", 
  I_COMMODITY = "8703330185",
  I_COMMODITY = "870340",
  I_COMMODITY = "870350",
  I_COMMODITY = "870360",
  I_COMMODITY = "870370",
  I_COMMODITY = "870380",
  I_COMMODITY = "8703900100",
  I_COMMODITY = "8704210100",
  I_COMMODITY = "8704310120", 
  I_COMMODITY = "8704310140", 
  I_COMMODITY = "870441", 
  I_COMMODITY = "870451",
  I_COMMODITY = "870460",
  CTY_NAME = "TOTAL FOR ALL COUNTRIES",
  CTY_NAME = "CHINA",
  CTY_NAME = "HONG KONG",
  CTY_NAME = "MEXICO",
  CTY_NAME = "CANADA",
  CTY_NAME = "EUROPEAN UNION",
  )

CAR_TOTAL <- CAR_IMPORTS %>%
  mutate(CON_VAL_YR = as.numeric(CON_VAL_YR)) %>%
  group_by(CTY_NAME) %>%
  summarize(time,CTY_CODE,CON_VAL_YR = sum(CON_VAL_YR, na.rm = TRUE)) %>%
  ungroup() %>%
  unique()


CAR_IMPORTS_USMCA <- getCensus(
  name = "timeseries/intltrade/imports/hs",
  vars = c("CON_VAL_YR","I_COMMODITY","CTY_CODE", "CTY_NAME"), 
  time = "2024-12",
  I_COMMODITY = "8703220110", 
  I_COMMODITY = "8703220190", 
  I_COMMODITY = "8703230110",
  I_COMMODITY = "8703230120",
  I_COMMODITY = "8703230130",
  I_COMMODITY = "8703230140",
  I_COMMODITY = "8703230160",
  I_COMMODITY = "8703230170",
  I_COMMODITY = "8703230190",
  I_COMMODITY = "8703240110",
  I_COMMODITY = "8703240130",
  I_COMMODITY = "8703240140",
  I_COMMODITY = "8703240150",
  I_COMMODITY = "8703240160",
  I_COMMODITY = "8703240190",
  I_COMMODITY = "8703310100",
  I_COMMODITY = "8703320110",
  I_COMMODITY = "8703320150", 
  I_COMMODITY = "8703330110", 
  I_COMMODITY = "8703330130", 
  I_COMMODITY = "8703330145", 
  I_COMMODITY = "8703330185",
  I_COMMODITY = "870340",
  I_COMMODITY = "870350",
  I_COMMODITY = "870360",
  I_COMMODITY = "870370",
  I_COMMODITY = "870380",
  I_COMMODITY = "8703900100",
  I_COMMODITY = "8704210100",
  I_COMMODITY = "8704310120", 
  I_COMMODITY = "8704310140", 
  I_COMMODITY = "870441", 
  I_COMMODITY = "870451",
  I_COMMODITY = "870460",
  CTY_NAME = "TOTAL FOR ALL COUNTRIES",
  CTY_NAME = "CHINA",
  CTY_NAME = "HONG KONG",
  CTY_NAME = "MEXICO",
  CTY_NAME = "CANADA",
  CTY_NAME = "EUROPEAN UNION",
  RP = "18",
)

CAR_TOTAL_USMCA <- CAR_IMPORTS_USMCA %>%
  mutate(CON_VAL_YR = as.numeric(CON_VAL_YR)) %>%
  group_by(CTY_NAME) %>%
  summarize(time,CTY_CODE,CON_VAL_YR = sum(CON_VAL_YR, na.rm = TRUE)) %>%
  ungroup() %>%
  unique()


BULK_IMPORTS <- getCensus(
  name = "timeseries/intltrade/imports/hs",
  vars = c("CON_VAL_YR","I_COMMODITY","CTY_CODE", "CTY_NAME","COMM_LVL"), 
  time = "2024-12",
  COMM_LVL = "HS10", #10 DIGIT HS CODE
  CTY_NAME = "TOTAL FOR ALL COUNTRIES",
  CTY_NAME = "CHINA",
  CTY_NAME = "HONG KONG",
  CTY_NAME = "MEXICO",
  CTY_NAME = "CANADA",
  CTY_NAME = "EUROPEAN UNION",
)

ALUMINUM_IMPORTS <- BULK_IMPORTS %>%
  filter(I_COMMODITY %in% c(
    7601103000, 7601106030, 7601106090, 7601203000, 7601206000, 7601209030,
    7601209045, 7601209060, 7601209075, 7601209080, 7601209085, 7601209095,
    7604101000, 7604103000, 7604105000, 7604210010, 7604210090, 7604291010,
    7604291090, 7604293030, 7604293060, 7604293090, 7604295020, 7604295050,
    7604295090, 7605110000, 7605190000, 7605210000, 7605290000, 7606113030,
    7606113060, 7606116000, 7606123015, 7606123025, 7606123035, 7606123045,
    7606123055, 7606123091, 7606123096, 7606126000, 7606913055, 7606913095,
    7606916055, 7606916095, 7606923025, 7606923035, 7606926055, 7606926095,
    7607113000, 7607116010, 7607116090, 7607119030, 7607119060, 7607119090,
    7607191000, 7607193000, 7607196000, 7607201000, 7607205000, 7608100030,
    7608100090, 7608200030, 7608200090, 7609000000, 7616995160, 7616995170,
    7610100010, 7610100020, 7610100030, 7610900020, 7610900040, 7610900060,
    7610900080, 7615102015, 7615102025, 7615103015, 7615103025, 7615105020,
    7615105040, 7615107125, 7615107130, 7615107155, 7615107180, 7615109100,
    7615200000, 7616109090, 7616991000, 7616995130, 7616995140, 7616995190
  ))

ALUMINUM_TOTAL <- ALUMINUM_TOTAL %>%
  mutate(CON_VAL_YR = as.numeric(CON_VAL_YR)) %>%
  group_by(CTY_NAME) %>%
  summarize(time,CTY_CODE,CON_VAL_YR = sum(CON_VAL_YR, na.rm = TRUE)) %>%
  ungroup() %>%
  unique()

ALUMINUM_DERIVATIVE_IMPORTS <- BULK_IMPORTS %>%
  filter(I_COMMODITY %in% c(
    7614105000, 7614902030, 7614902060, 7614904000, 7614905000, 8708103030,
    8708292130, 8302103000, 8302106030, 8302106060, 8302106090, 8302200000,
    8302303010, 8302303060, 8302413000, 8302416015, 8302416045, 8302416050,
    8302416080, 8302423010, 8302423015, 8302423065, 8302496035, 8302496045,
    8302496055, 8302496085, 8302500000, 8302603000, 8302609000, 8305100010,
    8305100050, 8306300000, 8414596590, 8415908025, 8415908045, 8415908085,
    8418998005, 8418998050, 8418998060, 8419901000, 8422900680, 8473302000,
    8473305100, 8479899596, 8481909060, 8481909085, 8486900000, 8487900040,
    8487900080, 8503009520, 8508700000, 8513902000, 8515902000, 8516905000,
    8516908050, 8517710000, 8517790000, 8529907300, 8529909760, 8536908585,
    8538100000, 8541900000, 8543908885, 8547900010, 8547900020, 8547900030,
    8547900040, 8708106010, 8708106050, 8708295160, 8708806590, 8708996890,
    8716805010, 8807300015, 8807300030, 8807300060, 9013908000, 9031909195,
    9401999081, 9403100020, 9403100040, 9403200011, 9403200016, 9403200017,
    9403200035, 9403200040, 9403200046, 9403200048, 9403200050, 9403200075,
    9403200078, 9403200082, 9403200086, 9403200090, 9403991040, 9403999010,
    9403999015, 9403999020, 9403999040, 9403999045, 9405992000, 9506114080,
    9506514000, 9506516000, 9506594040, 9506702090, 9506910010, 9506910020,
    9506910030, 9506990510, 9506990520, 9506990530, 9506991500, 9506992000,
    9506992580, 9506992800, 9506995500, 9506996080, 9507302000, 9507304000,
    9507306000, 9507308000, 9507906000, 9603908050, 6603908100
  ))

ALUMINUM_DERIVATIVE_TOTAL <- ALUMINUM_DERIVATIVE_IMPORTS %>%
  mutate(CON_VAL_YR = as.numeric(CON_VAL_YR)) %>%
  group_by(CTY_NAME) %>%
  summarize(time,CTY_CODE,CON_VAL_YR = sum(CON_VAL_YR, na.rm = TRUE)) %>%
  ungroup() %>%
  unique()

STEEL_IMPORTS <- BULK_IMPORTS %>%
  filter(I_COMMODITY %in% c(
    7206100000,7206900000,7207110000,7207120010,7207120050,7207190030,7207190090,7207200025,
    7207200045,7207200075,7207200090,7208101500,7208103000,7208106000,7208253000,7208256000,
    7208260030,7208260060,7208270040,7208270045,7208270060,7208360030,7208360060,7208370030,
    7208370060,7208380015,7208380030,7208380090,7208390020,7208390025,7208390030,7208390090,
    7208403030,7208403060,7208406030,7208406060,7208510030,7208510045,7208510060,7208520000,
    7208530000,7208540000,7208900000,7209150000,7209160040,7209160045,7209160060,7209160070,
    7209160091,7209170040,7209170045,7209170060,7209170070,7209170091,7209181530,7209181560,
    7209182520,7209182585,7209186020,7209186090,7209250000,7209260000,7209270000,7209280000,
    7209900000,7210110000,7210120000,7210200000,7210300030,7210300060,7210410000,7210490040,
    7210490045,7210490091,7210490095,7210500020,7210500090,7210610000,7210690000,7210703000,
    7210706030,7210706060,7210706090,7210901000,7210906000,7210909000,7211130000,7211140030,
    7211140045,7211140090,7211191500,7211192000,7211193000,7211194500,7211196000,7211197530,
    7211197560,7211197590,7211231500,7211232000,7211233000,7211234500,7211236030,7211236060,
    7211236090,7211292030,7211292090,7211294500,7211296030,7211296080,7211900000,7212100000,
    7212200000,7212301030,7212301090,7212303000,7212305000,7212401000,7212405000,7212500000,
    7212600000,7213100000,7213200010,7213200080,7213913011,7213913015,7213913020,7213913093,
    7213914500,7213916000,7213990030,7213990060,7213990090,7214100000,7214200000,7214300010,
    7214300080,7214910016,7214910020,7214910060,7214910090,7214990016,7214990021,7214990026,
    7214990031,7214990036,7214990040,7214990045,7214990060,7214990075,7214990090,7215100010,
    7215100080,7215500016,7215500018,7215500020,7215500061,7215500063,7215500065,7215500090,
    7215901000,7215903000,7215905000,7216100010,7216100050,7216210000,7216220000,7216310000,
    7216320000,7216330030,7216330060,7216330090,7216400010,7216400050,7216500000,7216990010,
    7216990090,7217101000,7217102000,7217103000,7217104040,7217104045,7217104090,7217105030,
    7217105090,7217106000,7217107000,7217108010,7217108020,7217108025,7217108030,7217108045,
    7217108060,7217108075,7217108090,7217109000,7217201500,7217203000,7217204510,7217204520,
    7217204530,7217204540,7217204550,7217204560,7217204570,7217204580,7217206000,7217207500,
    7217301530,7217301560,7217303000,7217304504,7217304511,7217304520,7217304530,7217304541,
    7217304550,7217304560,7217304590,7217306000,7217307500,7217901000,7217905030,7217905060,
    7217905090,7218100000,7218910015,7218910030,7218910060,7218990015,7218990030,7218990045,
    7218990060,7218990090,7229200015,7229200090,7229900500,7229901000,7229905006,7229905008,7229905016,7229905031,
    7229905051,7229909000,7301100000,7302101010,7302101015,7302101025,7302101035,7302101045,
    7302101055,7302101065,7302101075,7302105020,7302105040,7302105060,7302400000,7302901000,
    7302909000,7304110020,7304110050,7304110080,7304191020,7304191030,7304191045,7304191060,
    7304191080,7304195020,7304195050,7304195080,7304220030,7304220045,7304220060,7304233000,
    7304236030,7304236045,7304236060,7304243010,7304243020,7304243030,7304243040,7304243045,
    7304243080,7304244010,7304244020,7304244030,7304244040,7304244050,7304244060,7304244080,
    7304246015,7304246030,7304246045,7304246060,7304246075,7304291010,7304291020,7304291030,
    7304291040,7304291050,7304291060,7304291080,7304292010,7304292020,7304292030,7304292040,
    7304292050,7304292060,7304292080,7304293110,7304293120,7304293130,7304293140,7304293150,
    7304293160,7304293180,7304294110,7304294120,7304294130,7304294140,7304294150,7304294160,
    7304294180,7304295015,7304295030,7304295045,7304295060,7304295075,7304296115,7304296130,
    7304296145,7304296160,7304296175,7304313000,7304316010,7304316050,7304390002,7304390004,
    7304390006,7304390008,7304390016,7304390020,7304390024,7304390028,7304390032,7304390036,
    7304390040,7304390044,7304390048,7304390052,7304390056,7304390062,7304390068,7304390072,
    7304390076,7304390080,7304413005,7304413015,7304413045,7304416005,7304416015,7304416045,
    7304490005,7304490015,7304490045,7304490060,7304511000,7304515005,7304515015,7304515045,
    7304515060,7304591000,7304592030,7304592040,7304592045,7304592055,7304592060,7304592070,
    7304592080,7304596000,7304598010,7304598015,7304598020,7304598025,7304598030,7304598035,
    7304598040,7304598045,7304598050,7304598055,7304598060,7304598065,7304598070,7304598080,
    7304901000,7304903000,7304905000,7304907000,7305111030,7305111060,7305115000,7305121030,
    7305121060,7305125000,7305191030,7305191060,7305195000,7305202000,7305204000,7305206000,
    7305208000,7305312000,7305314000,7305316010,7305316090,7305391000,7305395000,7305901000,
    7305905000,7306101010,7306101050,7306105010,7306105050,7306110010,7306110050,7306191010,
    7306191050,7306195110,7306195150,7306213000,7306214000,7306218010,7306218050,7306291030,
    7306291090,7306292000,7306293100,7306294100,7306296010,7306296050,7306298110,7306298150,
    7306301000,7306303000,7306305010,7306305015,7306305020,7306305025,7306305028,7306305032,
    7306305035,7306305040,7306305055,7306305085,7306305090,7306401010,7306401015,7306401090,
    7306405005,7306405015,7306405040,7306405042,7306405044,7306405062,7306405064,7306405080,
    7306405085,7306405090,7306501000,7306503000,7306505010,7306505030,7306505050,7306505070,
    7306611000,7306613000,7306615000,7306617030,7306617060,7306691000,7306693000,7306695000,
    7306697030,7306697060,7306901000,7306905000.7301201000,7301205000,7302300000,7307211000,7307221000,7307225000,7307230030,7307230090,
    7307290030,7307290090,7307911000,7307913000,7307915010,7307915030,7307915050,7307915070,
    7307923010,7307923030,7307929000,7307933010,7307933040,7307936000,7307939010,7307939040,
    7307939060,7307991000,7307993000,7307995015,7307995045,7307995060,7308100000,7308200020,
    7308200090,7308301000,7308305015,7308305025,7308305050,7308400000,7308903000,7308906000,
    7308907000,7308909530,7308909560,7308909590,7309000030,7309000090,7310100005,7310100015,
    7310100090,7310210025,7310210050,7310290020,7310290030,7310290055,7310290065,7311000030,
    7311000060,7311000090,7312100500,7312101030,7312101050,7312101070,7312102000,7312103005,
    7312103010,7312103012,7312103020,7312103045,7312103065,7312103070,7312103074,7312103080,
    7312105000,7312106030,7312106060,7312107000,7312108000,7312109030,7312109060,7312109090,
    7312900000,7313000000,7314121000,7314122000,7314123000,7314126000,7314129000,7314141000,
    7314142000,7314143000,7314146000,7314149000,7314190100,7314200000,7314311000,7314315010,
    7314315080,7314390000,7314410030,7314410040,7314410045,7314410080,7314420030,7314420060,
    7314493000,7314496000,7314500000,7315110005,7315110010,7315110045,7315110060,7315120020,
    7315120040,7315120060,7315120080,7315190000,7315201000,7315205000,7315810000,7315821000,
    7315823000,7315825000,7315827000,7315891000,7315893000,7315895000,7315900000,7316000000,
    7317001000,7317002000,7317003000,7317005501,7317005502,7317005503,7317005505,7317005507,
    7317005508,7317005511,7317005518,7317005519,7317005520,7317005530,7317005540,7317005550,
    7317005560,7317005570,7317005580,7317005590,7317006530,7317006560,7317007500,7318110000,
    7318120000,7318130030,7318130060,7318141030,7318141060,7318145020,7318145080,7318152010,
    7318152020,7318152030,7318152041,7318152046,7318152051,7318152055,7318152061,7318152065,
    7318152091,7318152095,7318154000,7318155030,7318155051,7318155056,7318155090,7318156010,
    7318156040,7318156070,7318156080,7318158020,7318158030,7318158045,7318158055,7318158066,
    7318158069,7318158082,7318158085,7318160015,7318160030,7318160045,7318160060,7318160085,
    7318190000,7318210030,7318210090,7318220000,7318230000,7318240000,7318290000,7319402010,
    7319402050,7319403000,7319405010,7319405050,7319901000,7319909000,7320103000,7320106015,
    7320106060,7320109015,7320109060,7320201000,7320205010,7320205020,7320205045,7320205060,
    7320901000,7320905010,7320905020,7320905060,7321111030,7321111060,7321113010,7321113020,
    7321113050,7321116000,7321120000,7321190020,7321190040,7321190060,7321190080,7321811000,
    7321815000,7321821000,7321825000,7321890010,7321890050,7321901000,7321902000,7321904000,
    7321905000,7321906040,7321906060,7321906090,7326908688
  ))

STEEL_TOTAL <- STEEL_IMPORTS %>%
  mutate(CON_VAL_YR = as.numeric(CON_VAL_YR)) %>%
  group_by(CTY_NAME) %>%
  summarize(time,CTY_CODE,CON_VAL_YR = sum(CON_VAL_YR, na.rm = TRUE)) %>%
  ungroup() %>%
  unique()

STEEL_DERIVATIVES_IMPORTS <- BULK_IMPORTS %>%
  filter(I_COMMODITY %in% c(
    7317003000,7317005503,7317005505,7317005507,7317005560,7317005580,7317006560,
    8708103020,8708292120,8431310020,8431310040,8431310060,8431420000,8431491010,
    8431491060,8431491090,8431499005,8431499010,8431499015,8431499020,8431499025,
    8431499030,8431499035,8431499036,8431499038,8431499044,8431499045,8431499050,
    8431499055,8431499081,8431499084,8431499090,8431499095,8432100020,8432100040,
    8432100060,8432900010,8432900020,8432900040,8432900050,8432900060,8432900081,
    8547900010,8547900020,8547900030,8547900040,9403200011,9403200016,9403200017,
    9403200035,9403200040,9403200046,9403200048,9403200050,9403200075,9403200078,
    9403200082,9403200086,9403200090,9403992040,9403992080,9403994005,9403994010,
    9403994080,9406200000,9406900110,9406900120,9406900130,9406900150,9406900190
  ))

STEEL_DERIVATIVES_TOTAL <- STEEL_DERIVATIVES_IMPORTS %>%
  mutate(CON_VAL_YR = as.numeric(CON_VAL_YR)) %>%
  group_by(CTY_NAME) %>%
  summarize(time,CTY_CODE,CON_VAL_YR = sum(CON_VAL_YR, na.rm = TRUE)) %>%
  ungroup() %>%
  unique()



IMPLEMENTED <- data.frame(
  date = seq(as.Date("2025-01-20"), Sys.Date() + 60, by = "day"),
  value = ifelse(seq(as.Date("2025-01-20"), Sys.Date() + 60, by = "day") < as.Date("2025-02-04"), 0, CHINA_TOTAL$CON_VAL_YR[1]),
  category = "Implemented"
)

SIGNED <- data.frame(
  date = seq(as.Date("2025-01-20"), Sys.Date() + 60, by = "day"),
  value = ifelse(seq(as.Date("2025-01-20"), Sys.Date() + 60, by = "day") < as.Date("2025-03-04"), 0, CANADA_TOTAL$CON_VAL_YR[1] + MEXICO_TOTAL$CON_VAL_YR[1]),
  category = "Signed, Not Yet Implemented"
) %>%
  mutate(value = ifelse(seq(as.Date("2025-01-20"), Sys.Date() + 60, by = "day") < as.Date("2025-03-12"), value, value + (STEEL_TOTAL$CON_VAL_YR[STEEL_TOTAL$CTY_NAME == "TOTAL FOR ALL COUNTRIES"]-STEEL_TOTAL$CON_VAL_YR[STEEL_TOTAL$CTY_NAME == "MEXICO"]-STEEL_TOTAL$CON_VAL_YR[STEEL_TOTAL$CTY_NAME == "CANADA"]-STEEL_TOTAL$CON_VAL_YR[STEEL_TOTAL$CTY_NAME == "CHINA"]-STEEL_TOTAL$CON_VAL_YR[STEEL_TOTAL$CTY_NAME == "HONG KONG"]))) %>% #MARCH 12 STEEL TARIFFS + ALUMINUM TARIFFS MINUS CAN/MX/CHINA
  mutate(value = ifelse(seq(as.Date("2025-01-20"), Sys.Date() + 60, by = "day") < as.Date("2025-03-12"), value, value + (ALUMINUM_TOTAL$CON_VAL_YR[ALUMINUM_TOTAL$CTY_NAME == "TOTAL FOR ALL COUNTRIES"]-ALUMINUM_TOTAL$CON_VAL_YR[ALUMINUM_TOTAL$CTY_NAME == "MEXICO"]-ALUMINUM_TOTAL$CON_VAL_YR[ALUMINUM_TOTAL$CTY_NAME == "CANADA"]-ALUMINUM_TOTAL$CON_VAL_YR[STEEL_TOTAL$CTY_NAME == "CHINA"]-ALUMINUM_TOTAL$CON_VAL_YR[STEEL_TOTAL$CTY_NAME == "HONG KONG"])))

THREATENED <- data.frame(
  date = seq(as.Date("2025-01-20"), Sys.Date() + 60, by = "day"),
  value = ifelse(seq(as.Date("2025-01-20"), Sys.Date() + 60, by = "day") < as.Date("2025-04-02"), 0, EU_IMPORTS$CON_VAL_YR[1] - ALUMINUM_TOTAL$CON_VAL_YR[ALUMINUM_TOTAL$CTY_NAME == "EUROPEAN UNION"]-STEEL_TOTAL$CON_VAL_YR[STEEL_TOTAL$CTY_NAME == "EUROPEAN UNION"]),
  category = "Threatened, Not Yet Signed"
) %>%
  mutate(value = ifelse(seq(as.Date("2025-01-20"), Sys.Date() + 60, by = "day") < as.Date("2025-04-02"), value, value + (CAR_TOTAL$CON_VAL_YR[CAR_TOTAL$CTY_NAME == "TOTAL FOR ALL COUNTRIES"]-CAR_TOTAL$CON_VAL_YR[CAR_TOTAL$CTY_NAME == "MEXICO"]-CAR_TOTAL$CON_VAL_YR[CAR_TOTAL$CTY_NAME == "CANADA"]-CAR_TOTAL$CON_VAL_YR[CAR_TOTAL$CTY_NAME == "CHINA"]-CAR_TOTAL$CON_VAL_YR[CAR_TOTAL$CTY_NAME == "HONG KONG"]-CAR_TOTAL$CON_VAL_YR[CAR_TOTAL$CTY_NAME == "EUROPEAN UNION"]))) %>% #MARCH 12 STEEL TARIFFS + ALUMINUM TARIFFS MINUS CAN/MX/CHINA
  mutate(value = ifelse(seq(as.Date("2025-01-20"), Sys.Date() + 60, by = "day") < as.Date("2025-04-02"), value, value + (PHARMA_TOTAL$CON_VAL_YR[PHARMA_TOTAL$CTY_NAME == "TOTAL FOR ALL COUNTRIES"]-PHARMA_TOTAL$CON_VAL_YR[PHARMA_TOTAL$CTY_NAME == "MEXICO"]-PHARMA_TOTAL$CON_VAL_YR[PHARMA_TOTAL$CTY_NAME == "CANADA"]-PHARMA_TOTAL$CON_VAL_YR[PHARMA_TOTAL$CTY_NAME == "CHINA"]-PHARMA_TOTAL$CON_VAL_YR[PHARMA_TOTAL$CTY_NAME == "HONG KONG"]-PHARMA_TOTAL$CON_VAL_YR[PHARMA_TOTAL$CTY_NAME == "EUROPEAN UNION"]))) %>% #MARCH 12 STEEL TARIFFS + ALUMINUM TARIFFS MINUS CAN/MX/CHINA
  mutate(value = ifelse(seq(as.Date("2025-01-20"), Sys.Date() + 60, by = "day") < as.Date("2025-04-02"), value, value + (SEMI_TOTAL$CON_VAL_YR[SEMI_TOTAL$CTY_NAME == "TOTAL FOR ALL COUNTRIES"]-SEMI_TOTAL$CON_VAL_YR[SEMI_TOTAL$CTY_NAME == "MEXICO"]-SEMI_TOTAL$CON_VAL_YR[SEMI_TOTAL$CTY_NAME == "CANADA"]-SEMI_TOTAL$CON_VAL_YR[SEMI_TOTAL$CTY_NAME == "CHINA"]-SEMI_TOTAL$CON_VAL_YR[SEMI_TOTAL$CTY_NAME == "HONG KONG"]-SEMI_TOTAL$CON_VAL_YR[SEMI_TOTAL$CTY_NAME == "EUROPEAN UNION"]))) %>% #MARCH 12 STEEL TARIFFS + ALUMINUM TARIFFS MINUS CAN/MX/CHINA
  mutate(value = ifelse(seq(as.Date("2025-01-20"), Sys.Date() + 60, by = "day") < as.Date("2025-04-02"), value, value + (COPPER_TOTAL$CON_VAL_YR[COPPER_TOTAL$CTY_NAME == "TOTAL FOR ALL COUNTRIES"]-COPPER_TOTAL$CON_VAL_YR[COPPER_TOTAL$CTY_NAME == "MEXICO"]-COPPER_TOTAL$CON_VAL_YR[COPPER_TOTAL$CTY_NAME == "CANADA"]-COPPER_TOTAL$CON_VAL_YR[COPPER_TOTAL$CTY_NAME == "CHINA"]-COPPER_TOTAL$CON_VAL_YR[COPPER_TOTAL$CTY_NAME == "HONG KONG"]-COPPER_TOTAL$CON_VAL_YR[COPPER_TOTAL$CTY_NAME == "EUROPEAN UNION"])))#MARCH 12 STEEL TARIFFS + ALUMINUM TARIFFS MINUS CAN/MX/CHINA
  
TARIFF_STACKED <- rbind(IMPLEMENTED, SIGNED, THREATENED) %>%
  mutate(category = factor(category, levels = rev(c("Implemented","Signed, Not Yet Implemented","Threatened, Not Yet Signed"))))

TARIFF_STACKED_GRAPH <- ggplot(TARIFF_STACKED, aes(fill=category, x=date, y=value/1000000000000)) + 
  geom_bar(position="stack", stat="identity", size = 0, color = NA, width = 1.1) + #putting color to NA gets rid of borders
  annotate("hline", y = 0, yintercept = 0, color = "white", size = 0.5) +
  guides(fill = guide_legend(override.aes = list(shape = NA)), color = "none") +
  xlab("Date") +
  ylab("2024 Imports, Trillions of Dollars") + 
  scale_y_continuous(labels = scales::dollar_format(accuracy = 0.5, suffix = "T"), breaks = c(0,0.5,1,1.5,2,2.5,3), limits = c(0,3), expand = c(0,0)) +
  scale_x_date(breaks = TARIFF_STACKED$date[day(TARIFF_STACKED$date) == 1],
               labels = date_format("%b")) +
  ggtitle("A Timeline of Trump's Trade War") +
  labs(caption = "Graph created by @JosephPolitano using US Census data", subtitle = "Trump Has Signed or Threatened Tariffs Against Trillions in US Trade") +
  annotate(geom = "segment", x = as.Date("2025-02-04"), xend = as.Date("2025-02-01"), y = sum(TARIFF_STACKED$value[TARIFF_STACKED$date == "2025-02-04"], na.rm = TRUE)/1000000000000, yend = sum(TARIFF_STACKED$value[TARIFF_STACKED$date == "2025-02-04"], na.rm = TRUE)/1000000000000+0.25, color = "white", lwd = .75) +
  annotate(geom = "text", label = "China Tariffs", x = as.Date("2025-02-01"), y = sum(TARIFF_STACKED$value[TARIFF_STACKED$date == "2025-02-04"], na.rm = TRUE)/1000000000000+0.31, color ="white",size = 4, lineheight = unit(0.85,"cm")) +
  annotate(geom = "segment", x = as.Date("2025-03-04"), xend = as.Date("2025-03-01"), y = sum(TARIFF_STACKED$value[TARIFF_STACKED$date == "2025-03-04"], na.rm = TRUE)/1000000000000, yend = sum(TARIFF_STACKED$value[TARIFF_STACKED$date == "2025-03-04"], na.rm = TRUE)/1000000000000+0.25, color = "white", lwd = .75) +
  annotate(geom = "text", label = "Mexico/Canada Tariffs", x = as.Date("2025-03-01"), y = sum(TARIFF_STACKED$value[TARIFF_STACKED$date == "2025-03-04"], na.rm = TRUE)/1000000000000+0.31, color ="white",size = 4, lineheight = unit(0.85,"cm")) +
  annotate(geom = "segment", x = as.Date("2025-04-02"), xend = as.Date("2025-03-31"), y = sum(TARIFF_STACKED$value[TARIFF_STACKED$date == "2025-04-02"], na.rm = TRUE)/1000000000000, yend = sum(TARIFF_STACKED$value[TARIFF_STACKED$date == "2025-04-02"], na.rm = TRUE)/1000000000000+0.25, color = "white", lwd = .75) +
  annotate(geom = "text", label = "EU/Car/Pharma/Chip/Copper Tariffs", x = as.Date("2025-03-31"), y = sum(TARIFF_STACKED$value[TARIFF_STACKED$date == "2025-04-02"], na.rm = TRUE)/1000000000000+0.31, color ="white",size = 4, lineheight = unit(0.85,"cm")) +
  annotate(geom = "segment", x = today(), xend = today(), y = 0, yend = sum(TARIFF_STACKED$value[TARIFF_STACKED$date == today()], na.rm = TRUE)/1000000000000+0.25, color = "#F5B041", lwd = .75) +
  annotate(geom = "text", label = "Today", x = today(), y = sum(TARIFF_STACKED$value[TARIFF_STACKED$date == today()], na.rm = TRUE)/1000000000000+0.31, color ="#F5B041",size = 4, lineheight = unit(0.85,"cm")) +
  theme_apricitas + theme(legend.position = c(.25,.85)) +
  scale_fill_manual(name= "Imports Hit by New Tariffs",values = rev(c("#FF8E72","#6A4C93","#A7ACD9","#3083DC","#F5B041","#9A348E","#00A99D","#EE6055","#FFE98F"))) +
  annotation_custom(apricitas_logo_rast, xmin = as.Date("2018-01-01")-(.1861*(today()-as.Date("2018-01-01"))), xmax = as.Date("2018-01-01")-(0.049*(today()-as.Date("2018-01-01"))), ymin = 0-(.3*25), ymax = 0) + #these repeated sections place the logo in the bottom-right of each graph. The first number in all equations is the chart's origin point, and the second number is the exact length of the x or y axis
  coord_cartesian(clip = "off")

ggsave(dpi = "retina",plot = TARIFF_STACKED_GRAPH, "Tariff Stacked Graph.png", type = "cairo-png", width = 9.02, height = 5.76, units = "in")

sum(TARIFF_STACKED$value[as.Date(TARIFF_STACKED$date) == as.Date("2025-02-04")], na.rm = TRUE)

TOTAL_IMPORTS <- getCensus(
  name = "timeseries/intltrade/imports/hs",
  vars = c("CON_VAL_YR","CTY_CODE", "CTY_NAME"), 
  time = "2024-12",
  CTY_NAME = "TOTAL FOR ALL COUNTRIES",
)

TOTAL_IMPORTS <- getCensus(
  name = "timeseries/intltrade/imports/hs",
  vars = c("CON_VAL_YR","CTY_CODE", "CTY_NAME","CAL_DUT_YR"), 
  time = "2024-12",
  CTY_NAME = "TOTAL FOR ALL COUNTRIES",
)

TOTAL_IMPORTS <- TOTAL_IMPORTS %>%
  mutate(CON_VAL_YR = as.numeric(CON_VAL_YR)) %>%
  mutate(CAL_DUT_YR = as.numeric(CAL_DUT_YR))


IMPLEMENTED_SHARE <- data.frame(
  date = seq(as.Date("2025-01-20"), Sys.Date() + 3, by = "day"),
  value = ifelse(seq(as.Date("2025-01-20"), Sys.Date() + 3, by = "day") < as.Date("2025-02-04"), 0, CHINA_TOTAL$CON_VAL_YR[1]),
  category = "Implemented"
) %>%
  mutate(value = ifelse(seq(as.Date("2025-01-20"), Sys.Date() + 3, by = "day") < as.Date("2025-03-04"), value, value + CANADA_TOTAL$CON_VAL_YR[1])) %>% #Canada Tariffs
  mutate(value = ifelse(seq(as.Date("2025-01-20"), Sys.Date() + 3, by = "day") < as.Date("2025-03-04"), value, value + MEXICO_TOTAL$CON_VAL_YR[1])) %>% #Mexico Tariffs
  mutate(value = ifelse(seq(as.Date("2025-01-20"), Sys.Date() + 3, by = "day") < as.Date("2025-03-07"), value, value - MEXICO_TOTAL_USMCA$CON_VAL_YR[1])) %>% #Mexico Tariffs USMCA Exclusion
  mutate(value = ifelse(seq(as.Date("2025-01-20"), Sys.Date() + 3, by = "day") < as.Date("2025-03-07"), value, value - CANADA_TOTAL_USMCA$CON_VAL_YR[1])) %>% #Canada Tariffs USMCA Exclusion
  mutate(value = ifelse(seq(as.Date("2025-01-20"), Sys.Date() + 3, by = "day") < as.Date("2025-03-12"), value, value + STEEL_TOTAL$CON_VAL_YR[6] - STEEL_TOTAL$CON_VAL_YR[4] - STEEL_TOTAL$CON_VAL_YR[2])) %>% #Non-China Steel Tariffs
  mutate(value = ifelse(seq(as.Date("2025-01-20"), Sys.Date() + 3, by = "day") < as.Date("2025-03-12"), value, value + STEEL_DERIVATIVES_TOTAL$CON_VAL_YR[6] - STEEL_DERIVATIVES_TOTAL$CON_VAL_YR[4] - STEEL_DERIVATIVES_TOTAL$CON_VAL_YR[2])) %>% #Non-China Steel Tariffs
  mutate(value = ifelse(seq(as.Date("2025-01-20"), Sys.Date() + 3, by = "day") < as.Date("2025-03-12"), value, value + ALUMINUM_TOTAL$CON_VAL_YR[6] - ALUMINUM_TOTAL$CON_VAL_YR[4] - ALUMINUM_TOTAL$CON_VAL_YR[2])) %>% #Non-China Steel Tariffs
  mutate(value = ifelse(seq(as.Date("2025-01-20"), Sys.Date() + 3, by = "day") < as.Date("2025-03-12"), value, value + ALUMINUM_DERIVATIVE_TOTAL$CON_VAL_YR[6] - ALUMINUM_DERIVATIVE_TOTAL$CON_VAL_YR[4] - ALUMINUM_DERIVATIVE_TOTAL$CON_VAL_YR[2])) %>% #Non-China Steel Tariffs
  mutate(value = ifelse(seq(as.Date("2025-01-20"), Sys.Date() + 3, by = "day") < as.Date("2025-04-03"), value, value + 1557439458983 - CHINA_TOTAL$CON_VAL_YR[1])) %>% #Non-China Reciprocal Tariffs
  mutate(value = ifelse(seq(as.Date("2025-01-20"), Sys.Date() + 3, by = "day") < as.Date("2025-04-03"), value, value + CAR_TOTAL$CON_VAL_YR[6]-CAR_TOTAL$CON_VAL_YR[1]-CAR_TOTAL$CON_VAL_YR[5]+CAR_TOTAL_USMCA$CON_VAL_YR[1]+CAR_TOTAL_USMCA$CON_VAL_YR[2])) %>% #Non-China Reciprocal Tariffs
  mutate(value = value/TOTAL_IMPORTS$CON_VAL_YR[1])

EFFECTIVE_TARIFF <- data.frame(
  date = seq(as.Date("2025-01-20"), Sys.Date() + 3, by = "day"),
  value = ifelse(seq(as.Date("2025-01-20"), Sys.Date() + 3, by = "day") < as.Date("2025-02-04"), TOTAL_IMPORTS$CAL_DUT_YR[1]/TOTAL_IMPORTS$CON_VAL_YR[1], TOTAL_IMPORTS$CAL_DUT_YR[1]/TOTAL_IMPORTS$CON_VAL_YR[1] + .1*CHINA_TOTAL$CON_VAL_YR[1]/TOTAL_IMPORTS$CON_VAL_YR[1]), #10% China
  category = "Implemented"
) %>%
  mutate(value = ifelse(seq(as.Date("2025-01-20"), Sys.Date() + 3, by = "day") < as.Date("2025-03-04"), value, value + .1*CHINA_TOTAL$CON_VAL_YR[1]/TOTAL_IMPORTS$CON_VAL_YR[1])) %>% #10% China Again
  mutate(value = ifelse(seq(as.Date("2025-01-20"), Sys.Date() + 3, by = "day") < as.Date("2025-03-04"), value, value + .25*MEXICO_TOTAL$CON_VAL_YR[1]/TOTAL_IMPORTS$CON_VAL_YR[1])) %>% #25% MEXICO
  mutate(value = ifelse(seq(as.Date("2025-01-20"), Sys.Date() + 3, by = "day") < as.Date("2025-03-04"), value, value + .1*CANADA_SPLIT$CON_VAL_YR[2]/TOTAL_IMPORTS$CON_VAL_YR[1])) %>% #10% CANADIAN ENERGY
  mutate(value = ifelse(seq(as.Date("2025-01-20"), Sys.Date() + 3, by = "day") < as.Date("2025-03-04"), value, value + .25*(CANADA_SPLIT$CON_VAL_YR[1]-CANADA_SPLIT$CON_VAL_YR[2])/TOTAL_IMPORTS$CON_VAL_YR[1])) %>% #25% CANADA
  mutate(value = ifelse(seq(as.Date("2025-01-20"), Sys.Date() + 3, by = "day") < as.Date("2025-03-07"), value, value - .25*MEXICO_TOTAL_USMCA$CON_VAL_YR[1]/TOTAL_IMPORTS$CON_VAL_YR[1])) %>% #MEXICO USMCA EXCLUSION
  mutate(value = ifelse(seq(as.Date("2025-01-20"), Sys.Date() + 3, by = "day") < as.Date("2025-03-04"), value, value - .1*CANADA_SPLIT_USMCA$CON_VAL_YR[2]/TOTAL_IMPORTS$CON_VAL_YR[1])) %>% #10% CANADIAN ENERGY EXCLUSION
  mutate(value = ifelse(seq(as.Date("2025-01-20"), Sys.Date() + 3, by = "day") < as.Date("2025-03-07"), value, value - .25*(CANADA_SPLIT_USMCA$CON_VAL_YR[1]-CANADA_SPLIT_USMCA$CON_VAL_YR[2])/TOTAL_IMPORTS$CON_VAL_YR[1])) %>%#25% CANADA USMCA EXCLUSION
  mutate(value = ifelse(seq(as.Date("2025-01-20"), Sys.Date() + 3, by = "day") < as.Date("2025-03-12"), value, value + .25*STEEL_TOTAL$CON_VAL_YR[6]/TOTAL_IMPORTS$CON_VAL_YR[1])) %>% #25% MEXICO
  mutate(value = ifelse(seq(as.Date("2025-01-20"), Sys.Date() + 3, by = "day") < as.Date("2025-03-12"), value, value + .25*ALUMINUM_TOTAL$CON_VAL_YR[6]/TOTAL_IMPORTS$CON_VAL_YR[1])) %>% #25% MEXICO
  mutate(value = ifelse(seq(as.Date("2025-01-20"), Sys.Date() + 3, by = "day") < as.Date("2025-03-12"), value, value + 29000000000/TOTAL_IMPORTS$CON_VAL_YR[1])) %>% #USING BCG ESTIMATE FOR COST OF TARIFF ON DERIVATIVES
  mutate(value = ifelse(seq(as.Date("2025-01-20"), Sys.Date() + 3, by = "day") < as.Date("2025-03-04"), value, value - .6654735594*.25*CAR_TOTAL$CON_VAL_YR[1]/TOTAL_IMPORTS$CON_VAL_YR[1])) %>% #Excluding non-canadian content from vehicles
  mutate(value = ifelse(seq(as.Date("2025-01-20"), Sys.Date() + 3, by = "day") < as.Date("2025-03-04"), value, value - .491*.25*CAR_TOTAL$CON_VAL_YR[5]/TOTAL_IMPORTS$CON_VAL_YR[1])) %>% #Excluding non-Canadian content from vehicles
  mutate(value = ifelse(seq(as.Date("2025-01-20"), Sys.Date() + 3, by = "day") < as.Date("2025-03-04"), value, value + .25*CAR_TOTAL$CON_VAL_YR[6]/TOTAL_IMPORTS$CON_VAL_YR[1])) %>% #Excluding Non-Mexican Content
  mutate(value = ifelse(seq(as.Date("2025-01-20"), Sys.Date() + 3, by = "day") < as.Date("2025-04-03"), value, value + .10*1558459217222/TOTAL_IMPORTS$CON_VAL_YR[1])) %>% #10% RECIPROCAL
  mutate(value = ifelse(seq(as.Date("2025-01-20"), Sys.Date() + 3, by = "day") < as.Date("2025-04-09"), value, value + .1678111*1558459217222/TOTAL_IMPORTS$CON_VAL_YR[1])) #REST OF RECIPRICAL

TARIFF_TIMELINE_LINE_GRAPH <- ggplot() + #plotting integrated circuits exports
  annotate("hline", y = 0, yintercept = 0, color = "white", size = .5) +
  geom_line(data=IMPLEMENTED_SHARE, aes(x=date,y= value,color= "Share of US Imports Hit By New Tariffs"), size = 1.25) + 
  geom_line(data=EFFECTIVE_TARIFF, aes(x=date,y= value,color= "Tariff Rate on 2024 Import Mix"), size = 1.25) + 
  geom_segment(aes(x = as.Date("2025-02-03"), xend = as.Date("2025-02-03"), y = 0, yend = 0.29), color = "white", size = 1.25, linetype = "dashed") +
  annotate(geom = "text", label = "10% China Tariffs",x = as.Date("2025-02-02"), y = .25, size = 5,color = "white",hjust = 1, lineheight = 0.9) +
  geom_segment(aes(x = as.Date("2025-03-03"), xend = as.Date("2025-03-03"), y = 0, yend = 0.29), color = "white", size = 1.25, linetype = "dashed") +
  annotate(geom = "text", label = "10% China Tariffs\n25% Mexico Tariffs\n10-25% Canada Tariffs",x = as.Date("2025-03-02"), y = .225, size = 5,color = "white",hjust = 1, lineheight = 0.9) +
  geom_segment(aes(x = as.Date("2025-03-06"), xend = as.Date("2025-03-06"), y = 0, yend = 0.46), color = "white", size = 1.25, linetype = "dashed") +
  annotate(geom = "text", label = "Exclusion for\nUSMCA Goods\nFrom Canada\nand Mexico",x = as.Date("2025-03-07"), y = .425, size = 5,color = "white",hjust = 0, lineheight = 0.9) +
  geom_segment(aes(x = as.Date("2025-03-11"), xend = as.Date("2025-03-11"), y = 0, yend = 0.35), color = "white", size = 1.25, linetype = "dashed") +
  annotate(geom = "text", label = "25% Steel Tariffs\n25% Aluminum Tariffs",x = as.Date("2025-03-12"), y = .225, size = 5,color = "white",hjust = 0, lineheight = 0.9) +
  xlab("Date") +
  scale_y_continuous(labels = scales::percent_format(accuracy = 1),limits = c(0,.5), breaks = c(0,.05,.10,.15,.20,.25,.30,.35,.4,.45,.5), expand = c(0,0)) +
  ylab("% of Total US Imports") +
  ggtitle("A Timeline of Trump's 2nd-Term Trade Wars") +
  labs(caption = "Graph created by @JosephPolitano using US Census data.",subtitle = "In His 2nd Term, Trump Has Imposed Tariffs On Trillions of Dollars in US Trade") +
  theme_apricitas + theme(legend.position = c(.25,.89), plot.title = element_text(size = 27)) +
  scale_color_manual(name= NULL,values = c("#FFE98F","#00A99D","#EE6055","#9A348E","#A7ACD9","#3083DC")) +
  annotation_custom(apricitas_logo_rast, xmin = as.Date("2025-01-20")-(.1861*(today()-as.Date("2025-01-20"))), xmax = as.Date("2025-01-20")-(0.049*(today()-as.Date("2025-01-20"))), ymin = 0-(.3*(.5)), ymax = 0) +
  coord_cartesian(clip = "off")

ggsave(dpi = "retina",plot = TARIFF_TIMELINE_LINE_GRAPH, "Tariff Timeline Line Graph.png", type = "cairo-png", width = 9.02, height = 5.76, units = "in")



TARIFF_TIMELINE_LINE_RATE_GRAPH <- ggplot() + #plotting integrated circuits exports
  annotate("hline", y = 0, yintercept = 0, color = "white", size = .5) +
  #geom_line(data=IMPLEMENTED_SHARE, aes(x=date,y= value,color= "Share of US Imports Hit By New Tariffs"), size = 1.25) + 
  geom_segment(aes(x = as.Date("2025-02-03"), xend = as.Date("2025-02-03"), y = 0, yend = 0.075), color = "white", size = 1, linetype = "dashed") +
  annotate(geom = "text", label = "10% China",x = as.Date("2025-02-02"), y = .06, size = 4,color = "white",hjust = 1, lineheight = 0.9) +
  geom_segment(aes(x = as.Date("2025-03-03"), xend = as.Date("2025-03-03"), y = 0, yend = 0.155), color = "white", size = 1, linetype = "dashed") +
  annotate(geom = "text", label = "10% China\n25% Mexico\n10-25% Canada",x = as.Date("2025-03-02"), y = .125, size = 4, color = "white",hjust = 1, lineheight = 0.9) +
  geom_segment(aes(x = as.Date("2025-03-06"), xend = as.Date("2025-03-06"), y = 0, yend = 0.195), color = "white", size = 1, linetype = "dashed") +
  annotate(geom = "text", label = "Exclusion for\nUSMCA Goods\nFrom Canada\nand Mexico",x = as.Date("2025-03-07"), y = .18, size = 4,color = "white",hjust = 0, lineheight = 0.9) +
  geom_segment(aes(x = as.Date("2025-03-11"), xend = as.Date("2025-03-11"), y = 0, yend = 0.135), color = "white", size = 1, linetype = "dashed") +
  annotate(geom = "text", label = "25% Steel\n25% Aluminum",x = as.Date("2025-03-12"), y = 0.06, size = 4,color = "white",hjust = 0, lineheight = 0.9) +
  geom_segment(aes(x = as.Date("2025-04-02"), xend = as.Date("2025-04-02"), y = 0, yend = 0.26), color = "white", size = 1, linetype = "dashed") +
  annotate(geom = "text", label = "10% Most Countries\n25% Automobiles",x = as.Date("2025-04-01"), y = 0.235, size = 4,color = "white",hjust = 1, lineheight = 0.9) +
  geom_segment(aes(x = as.Date("2025-04-08"), xend = as.Date("2025-04-08"), y = 0, yend = 0.30), color = "white", size = 1, linetype = "dashed") +
  annotate(geom = "text", label = "Additional 10-40%\nMost Countries",x = as.Date("2025-04-07"), y = 0.28, size = 4,color = "white",hjust = 1, lineheight = 0.9) +
  geom_line(data=EFFECTIVE_TARIFF, aes(x=date,y= value,color= "Tariff Rate on 2024 Import Mix"), size = 1.25) + 
  xlab("Date") +
  scale_y_continuous(labels = scales::percent_format(accuracy = 1),limits = c(0,.3), breaks = c(0,.05,.10,.15,.20,.25,.30,.35,.4,.45,.5), expand = c(0,0)) +
  ylab("% of Total US Imports") +
  ggtitle("A Timeline of Trump's 2nd-Term Tariffs") +
  labs(caption = "Graph created by @JosephPolitano using US Census data.",subtitle = "In His 2nd Term, Trump Has Imposed Tariffs On Trillions of Dollars in US Trade") +
  theme_apricitas + theme(legend.position = c(.25,.89)) +
  scale_color_manual(name= NULL,values = c("#FFE98F","#00A99D","#EE6055","#9A348E","#A7ACD9","#3083DC")) +
  annotation_custom(apricitas_logo_rast, xmin = as.Date("2025-01-20")-(.1861*(today()-as.Date("2025-01-20"))), xmax = as.Date("2025-01-20")-(0.049*(today()-as.Date("2025-01-20"))), ymin = 0-(.3*(.3)), ymax = 0) +
  coord_cartesian(clip = "off")

ggsave(dpi = "retina",plot = TARIFF_TIMELINE_LINE_RATE_GRAPH, "Tariff Timeline Line Rate Graph.png", type = "cairo-png", width = 9.02, height = 5.76, units = "in")
